package com.wms.abstractclient.module.modules.exploit;

import com.wms.abstractclient.module.Module;
import com.wms.abstractclient.setting.Setting;
import com.wms.abstractclient.util.MovementUtil;
import net.minecraft.network.play.client.CPacketPlayer;
import org.lwjgl.input.Keyboard;

import java.util.Arrays;
import java.util.Random;


public class PacketFly extends Module {

    Setting mode = new Setting(this,"Mode", Arrays.asList("Up","Down","Preserve"));
    Setting antiKick = new Setting(this, "AntiKick", true);


    public PacketFly() {
        super("PacketFly", Category.EXPLOIT, Keyboard.KEY_NONE);
        addSetting(mode);
        addSetting(antiKick);
    }


    @Override
    public void onTick() {
    if (!nullcheck()) {
            mc.player.noClip = true;


            double x = MovementUtil.directionSpeed(0.20f)[0];
            double z = MovementUtil.directionSpeed(0.20f)[1];

            float speedY = 0;

            if (mc.player.movementInput.sneak) {
                speedY = -0.025f;
            }

            if (mc.player.movementInput.jump) {
                speedY = 0.025f;
            }

            mc.player.setVelocity(0, speedY, 0);
            sendPackets(x,speedY,z);

        }
    }

    public void sendPackets(double x, double y, double z){
        // Sending initial packets
        mc.player.connection.sendPacket(new CPacketPlayer.PositionRotation(mc.player.posX + x, mc.player.posY + y, mc.player.posZ + z, mc.player.rotationYaw, mc.player.rotationPitch, mc.player.onGround));

        Random r = new Random();

        float type = 0;
        if(mode.getEnumValue().equalsIgnoreCase("Up")){
            type = 490;
        }else if(mode.getEnumValue().equalsIgnoreCase("Down")){
            type = -490;
        }else {
            x += r.nextInt(100000);
            z += r.nextInt(100000);
        }

        // RubberBanding, the server then sends us back to the previous position
        mc.player.connection.sendPacket(new CPacketPlayer.PositionRotation(mc.player.posX, mc.player.posY + type, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch, mc.player.onGround));
    }

    @Override
    public void onDisable() {
        if(nullcheck()) {return;}
        mc.player.noClip = false;
    }
}